# Cloudflare configuration for OpenNext adapter
# Documentation: https://opennext.js.org/cloudflare

name = "ashok-world"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]

# Main worker entry point (generated by OpenNext)
main = ".open-next/worker.js"

# Assets configuration
[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "ashok-world-db"
database_id = "YOUR_DATABASE_ID_HERE"  # Replace after creating DB

# Environment variables (use Cloudflare dashboard for secrets)
[vars]
ENVIRONMENT = "production"

# Development settings
[dev]
port = 8788

# ============================================
# Setup Instructions:
# ============================================
#
# 1. Create D1 Database:
#    wrangler d1 create ashok-world-db
#
# 2. Update database_id above with the ID from step 1
#
# 3. Run migrations:
#    wrangler d1 execute ashok-world-db --local --file=./db/migrations/0001_initial.sql
#
# 4. For production:
#    wrangler d1 execute ashok-world-db --file=./db/migrations/0001_initial.sql
#
# 5. Build with OpenNext:
#    npx opennextjs-cloudflare build
#
# 6. Deploy to Cloudflare:
#    npm run deploy
#
# ============================================
# Cloudflare Access (Admin Protection):
# ============================================
#
# To protect /admin/* routes:
# 1. Go to Cloudflare Zero Trust dashboard
# 2. Access > Applications > Add an application
# 3. Select "Self-hosted"
# 4. Set application domain: your-domain.com
# 5. Set path: /admin/*
# 6. Configure identity providers (Google, GitHub, etc.)
# 7. Create access policies for allowed users
#
